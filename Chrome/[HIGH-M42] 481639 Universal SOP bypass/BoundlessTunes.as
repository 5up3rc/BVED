package {
    import flash.display.Sprite;
    import flash.media.Sound;
    import flash.events.Event;
    import flash.net.URLRequest;
    import flash.utils.ByteArray;
    import flash.external.ExternalInterface;

    public class BoundlessTunes extends Sprite 
    {
        private var sound:Sound;
        private const lookup_table:Object = { 49024: 0, 49022: 1, 49020: 2, 49018: 3, 49016: 4, 49014: 5, 49012: 6, 49010: 7, 49008: 8, 49006: 9, 49004: 10, 49002: 11, 49000: 12, 48998: 13, 48996: 14, 48994: 15, 48992: 16, 48990: 17, 48988: 18, 48986: 19, 48984: 20, 48982: 21, 48980: 22, 48978: 23, 48976: 24, 48974: 25, 48972: 26, 48970: 27, 48968: 28, 48966: 29, 48964: 30, 48962: 31, 48960: 32, 48958: 33, 48956: 34, 48954: 35, 48952: 36, 48950: 37, 48948: 38, 48946: 39, 48944: 40, 48942: 41, 48940: 42, 48938: 43, 48936: 44, 48934: 45, 48932: 46, 48930: 47, 48928: 48, 48926: 49, 48924: 50, 48922: 51, 48920: 52, 48918: 53, 48916: 54, 48914: 55, 48912: 56, 48910: 57, 48908: 58, 48906: 59, 48904: 60, 48902: 61, 48900: 62, 48898: 63, 48896: 64, 48892: 65, 48888: 66, 48884: 67, 48880: 68, 48876: 69, 48872: 70, 48868: 71, 48864: 72, 48860: 73, 48856: 74, 48852: 75, 48848: 76, 48844: 77, 48840: 78, 48836: 79, 48832: 80, 48828: 81, 48824: 82, 48820: 83, 48816: 84, 48812: 85, 48808: 86, 48804: 87, 48800: 88, 48796: 89, 48792: 90, 48788: 91, 48784: 92, 48780: 93, 48776: 94, 48772: 95, 48768: 96, 48760: 97, 48752: 98, 48744: 99, 48736: 100, 48728: 101, 48720: 102, 48712: 103, 48704: 104, 48696: 105, 48688: 106, 48680: 107, 48672: 108, 48664: 109, 48656: 110, 48648: 111, 48640: 112, 48624: 113, 48608: 114, 48592: 115, 48576: 116, 48560: 117, 48544: 118, 48528: 119, 48512: 120, 48480: 121, 48448: 122, 48416: 123, 48384: 124, 48320: 125, 48256: 126, 48128: 127, 0: 128, 15360: 129, 15488: 130, 15552: 131, 15616: 132, 15648: 133, 15680: 134, 15712: 135, 15744: 136, 15760: 137, 15776: 138, 15792: 139, 15808: 140, 15824: 141, 15840: 142, 15856: 143, 15872: 144, 15880: 145, 15888: 146, 15896: 147, 15904: 148, 15912: 149, 15920: 150, 15928: 151, 15936: 152, 15944: 153, 15952: 154, 15960: 155, 15968: 156, 15976: 157, 15984: 158, 15992: 159, 16000: 160, 16004: 161, 16008: 162, 16012: 163, 16016: 164, 16020: 165, 16024: 166, 16028: 167, 16032: 168, 16036: 169, 16040: 170, 16044: 171, 16048: 172, 16052: 173, 16056: 174, 16060: 175, 16064: 176, 16068: 177, 16072: 178, 16076: 179, 16080: 180, 16084: 181, 16088: 182, 16092: 183, 16096: 184, 16100: 185, 16104: 186, 16108: 187, 16112: 188, 16116: 189, 16120: 190, 16124: 191, 16128: 192, 16130: 193, 16132: 194, 16134: 195, 16136: 196, 16138: 197, 16140: 198, 16142: 199, 16144: 200, 16146: 201, 16148: 202, 16150: 203, 16152: 204, 16154: 205, 16156: 206, 16158: 207, 16160: 208, 16162: 209, 16164: 210, 16166: 211, 16168: 212, 16170: 213, 16172: 214, 16174: 215, 16176: 216, 16178: 217, 16180: 218, 16182: 219, 16184: 220, 16186: 221, 16188: 222, 16190: 223, 16192: 224, 16194: 225, 16196: 226, 16198: 227, 16200: 228, 16202: 229, 16204: 230, 16206: 231, 16208: 232, 16210: 233, 16212: 234, 16214: 235, 16216: 236, 16218: 237, 16220: 238, 16222: 239, 16224: 240, 16226: 241, 16228: 242, 16230: 243, 16232: 244, 16234: 245, 16236: 246, 16238: 247, 16240: 248, 16242: 249, 16244: 250, 16246: 251, 16248: 252, 16250: 253, 16252: 254, 49024: 255 };

        public function BoundlessTunes():void
        {
            var url:String = loaderInfo.parameters.url;
            
            sound = new Sound();
            sound.addEventListener(Event.COMPLETE, loaded);
            sound.load(new URLRequest(url));
        }

        private function loaded(event:Event):void
        {
            var encoded_bytes:ByteArray = new ByteArray();
            var decoded_bytes:ByteArray = new ByteArray();

            sound.extract(encoded_bytes, sound.bytesLoaded * 8);
            encoded_bytes.position = 0;
            while(encoded_bytes.bytesAvailable > 0)
            {
                decoded_bytes.writeByte(lookup_table[encoded_bytes.readUnsignedShort()]);
                encoded_bytes.position += 62;
            }
            ExternalInterface.call("alert", decoded_bytes.toString());
        }
    }
}